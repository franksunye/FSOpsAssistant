# FSOA 用户指南

Field Service Operations Assistant - 现场服务运营助手

## 1. 系统概述

FSOA是一个具备**主动性、自主决策、目标导向**的AI Agent系统，专为现场服务运营而设计：

### 1.1 核心价值
- **🎯 主动监控**：7x24小时自动扫描商机状态，智能缓存优化性能
- **🧠 智能决策**：规则引擎+LLM混合决策，基于上下文智能判断
- **📱 自动通知**：分级通知路由，组织级差异化通知和升级机制
- **📊 数据驱动**：完整的Agent执行追踪、通知任务管理和性能分析
- **🏗️ 管理器架构**：BusinessDataStrategy、NotificationTaskManager、AgentExecutionTracker三大核心管理器

### 1.2 业务场景
- **现场服务时效监控**：自动监控"待预约"、"暂不上门"等状态的SLA合规性
- **超时预警处理**：智能识别超时风险，主动发送分级通知
- **运营效率提升**：减少80%的重复性监控工作，提升响应速度
- **服务质量保障**：通过及时提醒提高现场服务SLA达成率

## 2. 快速开始

### 2.1 访问系统
1. 打开浏览器，访问：`http://your-server:8501`
2. 系统无需登录，直接进入智能运营仪表板

### 2.2 界面布局
```
┌─────────────────────────────────────────────────────────┐
│                🤖 FSOA 智能运营仪表板                    │
│              现场服务运营助手 - 主动监控•智能决策•自动通知  │
├─────────────────┬───────────────────────────────────────┤
│  📊 核心监控     │           🎯 核心业务指标              │
│  🎯 运营仪表板   │  🤖Agent状态  ⚠️逾期商机  🚨升级处理   │
│  📋 商机监控     │                                      │
│  📈 业务分析     │           🚀 Agent智能化价值           │
│                │  🎯主动监控  🧠智能决策  📱自动通知      │
│  🤖 Agent管理   │                                      │
│  🎛️ Agent控制台 │           ⚡ 快速操作                 │
│  🔍 执行历史     │  🚀立即执行  📋查看商机  📬管理通知     │
│  📬 通知管理     │                                      │
│                │                                      │
│  ⚙️ 系统管理     │                                      │
│  💾 缓存管理     │                                      │
│  🔧 企微群配置   │                                      │
│  🧪 系统测试     │                                      │
└─────────────────┴───────────────────────────────────────┘
```

## 3. 功能详解

### 3.1 🎯 运营仪表板
**功能说明：** 系统核心价值展示和快速操作入口

**核心业务指标：**
- **🤖 Agent状态**：智能监控运行状态，实时显示系统健康度
- **⚠️ 逾期商机**：当前需要关注的超时商机数量
- **🚨 升级处理**：需要升级处理的紧急商机数量
- **🏢 涉及组织**：受影响的组织数量和缓存性能

**Agent智能化价值展示：**
- **🎯 主动监控**：7x24小时自动扫描，实时识别超时风险，无需人工干预
- **🧠 智能决策**：规则引擎+LLM混合决策，基于上下文智能判断，自适应策略调整
- **📱 自动通知**：多企微群差异化通知，智能去重和频率控制，升级机制自动触发

**快速操作：**
- **🚀 立即执行Agent**：手动触发Agent执行完整监控流程
- **📋 查看商机列表**：跳转到商机监控页面查看详细信息
- **📬 管理通知任务**：跳转到通知管理页面处理待发送任务
- **🔄 刷新数据**：刷新当前页面数据

### 3.2 📋 商机监控
**功能说明：** 实时监控现场服务商机时效状态

**商机信息字段：**
- **工单号**：Metabase中的唯一标识符
- **客户名称**：服务对象名称
- **服务地址**：现场服务地址
- **负责人**：现场服务负责人
- **创建时间**：商机创建时间
- **所属组织**：负责的运营组织
- **当前状态**：待预约/暂不上门/已完成等
- **已用时长**：从创建到现在的时间
- **超时状态**：是否超过SLA时间
- **升级级别**：0=正常，1=需要升级处理

**智能筛选：**
```
┌─────────────────────────────────────────────────────┐
│ 状态: [全部▼] 组织: [全部▼] 超时: [全部▼] 升级: [全部▼] │
│ 搜索: [工单号/客户名称/地址]              [🔍 搜索]  │
└─────────────────────────────────────────────────────┘
```

**智能操作：**
- **查看详情**：点击商机行查看完整信息和处理历史
- **手动通知**：对特定商机立即发送通知
- **标记处理**：更新商机处理状态
- **批量操作**：选择多个商机进行批量通知

### 3.3 🤖 Agent控制台
**功能说明：** Agent生命周期管理和执行监控

**Agent状态监控：**
- **运行状态**：当前Agent是否正在运行
- **调度器状态**：定时任务调度器状态
- **活跃任务数**：当前正在执行的任务数量
- **下次执行时间**：预计下次自动执行时间

**执行控制：**
- **🚀 立即执行Agent**：手动触发完整的监控流程
  - 获取商机数据 → 创建通知任务 → 执行通知发送 → 记录结果
  - 显示详细的执行统计：执行ID、处理商机数、发送通知数、失败数
- **🧪 试运行**：模拟执行流程，不实际发送通知
  - 显示缓存状态和统计信息
  - 预览将要处理的商机数量

**调度器管理：**
- **▶️ 启动调度器**：启动定时任务调度
- **⏸️ 停止调度器**：停止自动执行
- **🔄 重启调度器**：重新启动调度服务
- **📊 刷新状态**：更新当前状态信息

### 3.4 🔍 执行历史
**功能说明：** Agent执行历史和性能分析

**执行统计：**
- **总运行次数**：Agent历史执行总次数
- **成功运行**：成功完成的执行次数
- **失败运行**：执行失败的次数
- **平均耗时**：每次执行的平均时间

**步骤性能分析：**
- **fetch_opportunities**：获取商机数据的性能统计
- **process_opportunities**：处理商机逻辑的性能统计
- **send_notifications**：发送通知的性能统计
- 每个步骤显示：执行次数、成功次数、平均耗时

### 3.5 📬 通知管理
**功能说明：** 通知任务状态管理和监控

**通知统计：**
- **总任务数**：创建的通知任务总数
- **已发送**：成功发送的通知数量
- **发送失败**：发送失败的通知数量
- **待处理**：等待发送的通知数量

**待处理任务列表：**
- **工单号**：关联的商机工单号
- **组织**：负责的运营组织
- **类型**：standard（标准通知）/escalation（升级通知）
- **状态**：pending（待发送）/sent（已发送）/failed（失败）
- **应发送时间**：计划发送的时间
- **重试次数**：失败后的重试次数
- **消息内容**：通知的具体内容

**管理操作：**
- **🔄 刷新任务列表**：更新任务状态
- **🧹 清理旧任务**：清理已完成的历史任务

### 3.6 💾 缓存管理
**功能说明：** 业务数据缓存监控和管理

**缓存状态：**
- **缓存状态**：启用/禁用状态
- **缓存条目**：当前缓存的数据条目数
- **有效缓存**：未过期的缓存条目数
- **命中率**：缓存命中率百分比

**缓存详情：**
- **TTL设置**：缓存生存时间（小时）
- **逾期缓存**：缓存中的逾期商机数量
- **涉及组织**：缓存数据涉及的组织数量
- **缓存启用**：当前缓存策略是否启用

**缓存操作：**
- **🔄 刷新缓存**：从Metabase重新获取数据更新缓存
- **🧹 清理缓存**：清空所有缓存数据
- **🔍 验证一致性**：检查缓存数据与源数据的一致性

### 3.4 系统设置
**功能说明：** 配置系统参数和业务规则

#### 3.4.1 Agent设置
```
执行频率: [60] 分钟
使用LLM优化: [✓] 启用
LLM温度参数: [0.1]
最大重试次数: [3]
```

#### 3.4.2 通知设置
```
每小时最大通知数: [10]
通知冷却时间: [30] 分钟
升级阈值: [4] 小时
启用智能去重: [✓] 启用
```

#### 3.4.3 群组管理
```
┌─────────────────────────────────────────┐
│ 群组名称    │ Webhook地址      │ 状态   │ 操作 │
├─────────────────────────────────────────┤
│ 运维组A     │ https://qy...    │ 启用   │ 编辑 │
│ 运维组B     │ https://qy...    │ 启用   │ 编辑 │
│ 运维组C     │ https://qy...    │ 禁用   │ 编辑 │
└─────────────────────────────────────────┘
[+ 添加新群组]
```

## 4. 典型使用场景

### 4.1 日常监控
**场景：** 运营人员每天查看任务状态

**操作步骤：**
1. 打开FSOA系统
2. 查看仪表板了解整体状况
3. 点击"任务列表"查看具体任务
4. 关注超时任务，确认是否需要人工干预

### 4.2 处理超时任务
**场景：** 发现有任务超时需要处理

**操作步骤：**
1. 在任务列表中筛选"已超时"状态
2. 点击具体任务查看详情
3. 如需立即提醒，点击"发送提醒"
4. 联系现场人员确认情况
5. 根据反馈更新任务状态

### 4.3 配置新的企微群
**场景：** 新增一个运维团队需要接收通知

**操作步骤：**
1. 进入"系统设置" → "群组管理"
2. 点击"添加新群组"
3. 填写群组信息：
   - 群组名称：如"运维组D"
   - Webhook地址：从企微群机器人获取
   - 启用状态：选择"启用"
4. 点击"保存"完成配置
5. 在"测试"按钮验证配置是否正确

### 4.4 调整通知策略
**场景：** 发现通知过于频繁，需要调整

**操作步骤：**
1. 进入"系统设置" → "通知设置"
2. 调整相关参数：
   - 增加"通知冷却时间"（如从30分钟改为60分钟）
   - 降低"每小时最大通知数"（如从10改为5）
3. 点击"保存设置"
4. 观察后续几天的通知频率是否合适

## 5. 故障排查

### 5.1 Agent未运行
**症状：** 仪表板显示Agent状态为"已停止"

**排查步骤：**
1. 检查系统日志是否有错误信息
2. 确认Metabase连接是否正常
3. 检查DeepSeek API是否可用
4. 尝试手动执行Agent
5. 如问题持续，联系技术支持

### 5.2 通知发送失败
**症状：** 通知历史显示发送状态为"失败"

**排查步骤：**
1. 检查企微群Webhook地址是否正确
2. 确认群机器人是否被禁用
3. 检查网络连接是否正常
4. 尝试重新发送通知
5. 如持续失败，检查企微群设置

### 5.3 数据不更新
**症状：** 任务列表数据长时间未更新

**排查步骤：**
1. 确认Metabase服务是否正常
2. 检查数据库连接是否正常
3. 查看Agent执行日志
4. 手动触发数据同步
5. 联系系统管理员检查数据源

## 6. 最佳实践

### 6.1 日常使用建议
- **定期检查**：每天至少查看一次仪表板
- **及时响应**：收到通知后及时跟进处理
- **状态更新**：任务完成后及时更新状态
- **参数调优**：根据实际情况调整通知参数

### 6.2 配置建议
- **通知频率**：避免过于频繁的通知造成骚扰
- **群组管理**：按团队职责合理分配通知群组
- **阈值设置**：根据业务SLA合理设置超时阈值
- **备份配置**：定期备份重要的配置信息

### 6.3 性能优化
- **数据清理**：定期清理历史数据避免系统变慢
- **监控指标**：关注系统性能指标
- **资源使用**：避免在高峰期进行大量操作
- **版本更新**：及时更新到最新版本

## 7. 常见问题

### Q1: 为什么有些任务没有收到通知？
**A:** 可能的原因：
- 任务尚未超时
- 通知冷却时间未到
- 群组被禁用
- 网络连接问题

### Q2: 如何修改通知消息的内容？
**A:** 在系统设置中可以自定义消息模板，支持变量替换。

### Q3: Agent多久执行一次检查？
**A:** 默认每小时执行一次，可在系统设置中调整频率。

### Q4: 系统支持多少个企微群？
**A:** 理论上无限制，但建议不超过20个以确保性能。

### Q5: 如何查看详细的执行日志？
**A:** 在仪表板点击"查看详情"或联系系统管理员获取日志文件。

## 8. 联系支持

如遇到问题或需要帮助，请联系：
- **技术支持**：发送邮件至 support@company.com
- **产品反馈**：通过系统内的反馈功能提交
- **紧急问题**：拨打24小时支持热线 400-xxx-xxxx

---
> 用户指南持续更新，欢迎提供使用反馈和改进建议