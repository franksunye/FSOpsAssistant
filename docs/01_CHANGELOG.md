# FSOA 变更日志

Field Service Operations Assistant - 版本变更记录

本文档记录项目的重要变更，遵循 [Keep a Changelog](https://keepachangelog.com/) 规范。

## [未发布] - TBD

### 计划新增
- Agent执行性能优化
- 多语言消息模板支持
- 高级分析和报表功能
- 移动端适配

### 计划改进
- UI界面优化
- 错误处理增强
- 文档完善

## [0.2.0] - 2025-06-26

### 新增
- **工作时间计算模块**: 实现工作时间（早9点到晚7点）的精确计算
- **12小时违规检测**: 新增违规阈值，超过12小时工作时间即算违规
- **2小时冷静时间**: 通知发送后2小时内不再重复提醒
- **5次重试机制**: 每个通知任务最多重试5次，理论上可提醒6次
- **违规通知类型**: 新增VIOLATION通知类型，区别于标准和升级通知
- **工作时间SLA**: 所有SLA时间计算改为基于工作时间而非自然时间

### 变更
- **SLA规则重构**:
  - 待预约：12h违规 → 24h标准 → 24h升级
  - 暂不上门：12h违规 → 48h标准 → 48h升级
- **通知冷静时间**: 从30分钟延长到2小时（120分钟）
- **最大重试次数**: 从3次增加到5次
- **时间计算方式**: 从自然时间改为工作时间计算

### 技术改进
- **BusinessTimeCalculator**: 新增工作时间计算器类
- **OpportunityInfo模型**: 增加is_violation字段和工作时间计算支持
- **NotificationTask模型**: 增加冷静时间和重试控制字段
- **通知管理器**: 重构支持新的通知类型和重试机制
- **业务格式化器**: 新增违规通知格式化方法

### 数据库变更
- notification_tasks表新增字段：
  - max_retry_count: 最大重试次数
  - cooldown_hours: 冷静时间（小时）
  - last_sent_at: 最后发送时间

## [0.1.0] - 2025-06-25

### 新增
- **项目初始化**：完成项目基础架构设计
- **核心文档**：编写完整的项目文档体系
  - 项目概述和价值主张
  - 系统架构设计
  - 开发指南和规范
  - API接口文档
  - 测试策略和指南
  - 用户操作手册
- **技术架构**：确定核心技术栈
  - Python + LangGraph Agent框架
  - Streamlit Web界面
  - SQLite本地数据库
  - DeepSeek LLM集成
  - 企微Webhook通知
- **开发计划**：制定详细的Sprint计划
  - 4个Sprint，8周开发周期
  - 明确的功能优先级和里程碑
  - 完整的测试和部署策略

### 技术决策
- **Agent框架**：选择LangGraph作为Agent编排引擎
- **决策机制**：采用规则引擎+LLM的混合决策模式
- **数据集成**：通过Metabase API实现非侵入式数据获取
- **通知渠道**：基于企微Webhook的多群组通知
- **部署方式**：单机部署为主，支持容器化扩展

### 设计原则
- **Agentic特性**：体现主动性、自主决策、目标导向
- **KISS原则**：保持简单，避免过度设计
- **可扩展性**：模块化架构，支持功能扩展
- **企业级**：稳定可靠，支持生产环境使用

---

## 版本规范

### 版本号格式
采用语义化版本控制 (Semantic Versioning)：`MAJOR.MINOR.PATCH`

- **MAJOR**：不兼容的API变更
- **MINOR**：向后兼容的功能新增
- **PATCH**：向后兼容的问题修复

### 变更类型
- **新增 (Added)**：新功能
- **变更 (Changed)**：现有功能的变更
- **弃用 (Deprecated)**：即将移除的功能
- **移除 (Removed)**：已移除的功能
- **修复 (Fixed)**：问题修复
- **安全 (Security)**：安全相关的修复

### 发布流程
1. 更新版本号
2. 更新CHANGELOG
3. 创建Git标签
4. 发布Release
5. 部署到生产环境

---
> 变更日志帮助用户和开发者了解项目演进，请及时更新