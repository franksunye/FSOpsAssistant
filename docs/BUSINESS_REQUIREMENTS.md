# FSOA 业务需求规格说明

**版本**: v1.0
**更新时间**: 2025-06-25
**状态**: ✅ 生产就绪 - 架构重构完成

## 🎯 业务背景

### 业务场景
FSOA 系统用于监控和管理现场服务商机的跟进时效性。销售人员需要及时跟进商机，确保客户服务质量和转化率。

### 核心问题
- **商机跟进不及时**: 销售人员可能忘记或延迟跟进商机
- **状态更新滞后**: 商机状态长期停留在"待预约"或"暂不上门"
- **监控工作量大**: 运营人员需要人工监控大量商机状态
- **响应时间不一致**: 不同销售人员的响应时间差异较大

## 📊 数据源规格

### Metabase 数据源
- **数据地址**: `http://metabase.fsgo365.cn:3000/question/1712`
- **API 端点**: `{METABASE_URL}/api/card/1712/query`
- **更新频率**: 每天更新一次
- **数据权限**: 普通密钥即可获取

### 数据结构
```json
{
  "orderNum": "GD20250600803",
  "name": "客户",
  "address": "东方夏威夷南岸欧湖公寓",
  "supervisorName": "李纪龙",
  "createTime": "2025-6-14, 16:33",
  "orgName": "三河市中豫防水工程有限公司",
  "orderstatus": "待预约"
}
```

### 关键字段说明
- **orderNum**: 工单号，唯一标识
- **name**: 客户姓名
- **address**: 客户地址
- **supervisorName**: 负责销售人员
- **createTime**: 商机创建时间
- **orgName**: 所属组织/公司
- **orderstatus**: 商机状态（待预约、暂不上门等）

## 📋 业务规则

### SLA 规则定义

#### 1. 待预约状态
- **触发条件**: `orderstatus == "待预约"`
- **SLA 标准**: 创建时间超过 24 小时
- **业务含义**: 销售需要及时联系客户并在系统中填写预约时间
- **处理要求**: 销售人员必须在24小时内完成客户预约

#### 2. 暂不上门状态
- **触发条件**: `orderstatus == "暂不上门"`
- **SLA 标准**: 创建时间超过 48 小时
- **业务含义**: 客户首次通话未同意上门，需要持续跟进
- **处理要求**: 销售人员需要变换话术，尝试再次联系客户

### 升级机制

#### 标准逾期通知
- **待预约**: 超过 24 小时
- **暂不上门**: 超过 48 小时
- **通知对象**: 对应 orgName 的企微群
- **通知方式**: 机器人消息

#### 升级逾期通知
- **待预约**: 超过 48 小时
- **暂不上门**: 超过 72 小时
- **通知对象**: 内部运营群 + @特定人员
- **通知方式**: 机器人消息 + 人员提醒

## 🔔 通知规格

### 标准通知格式
```
📋 待预约工单提醒 (三河市中豫防水工程有限公司)

共有 3 个工单待预约：

01. 工单号：42852
     滞留时长：69天
     客户：先生
     地址：回龙观街道
     负责人：曹振锋
     创建时间：04-14
     状态：暂不上门

02. 工单号：44051
     滞留时长：63天
     客户：先生
     地址：鼓楼附近
     负责人：李会强
     创建时间：04-21
     状态：暂不上门

03. 工单号：00558
     滞留时长：62天
     客户：先生
     地址：北京市东城区中剪子巷
     负责人：李会强
     创建时间：04-22
     状态：暂不上门

请及时跟进处理，如有疑问请联系运营人员。
```

### 通知配置
- **orgName 映射**: 每个组织对应一个企微群 webhook
- **内部运营群**: 升级通知的目标群
- **@人员配置**: 升级时需要提醒的特定人员
- **通知频率**: 避免重复通知的冷却机制

## 📈 业务指标

### 核心 KPI
1. **逾期率**: 各状态任务的逾期比例
   - 待预约逾期率 = 超过24h的待预约任务 / 总待预约任务
   - 暂不上门逾期率 = 超过48h的暂不上门任务 / 总暂不上门任务

2. **平均处理时长**: 从创建到状态变更的时间
   - 平均预约时长 = 从创建到预约完成的平均时间
   - 平均跟进时长 = 从暂不上门到状态变更的平均时间

3. **通知响应率**: 通知后任务状态变更的比例
   - 4小时响应率 = 通知后4小时内状态变更的任务比例
   - 24小时响应率 = 通知后24小时内状态变更的任务比例

4. **组织绩效排名**: 各 orgName 的 SLA 达成情况
   - SLA达成率 = 按时处理的任务 / 总任务数
   - 平均响应时间 = 各组织的平均任务处理时间

### 运营指标
- **任务总量**: 每日新增商机数量
- **状态分布**: 各状态任务的数量分布
- **人员工作量**: 各销售人员的任务分配情况
- **转化效果**: 商机最终转化情况

## 🎛️ Web 界面需求

### 运营仪表板
1. **实时概览**
   - 当前逾期任务总数
   - 各状态任务分布饼图
   - 今日新增/处理任务数
   - 系统健康状态

2. **逾期任务列表**
   - 按逾期时长排序
   - 支持按组织、状态筛选
   - 显示详细任务信息
   - 支持批量操作

3. **组织绩效对比**
   - 各组织SLA达成率对比
   - 平均处理时长排名
   - 任务量分布情况
   - 趋势变化分析

### 配置管理界面
1. **企微群配置**
   - orgName 到 webhook URL 的映射
   - 内部运营群配置
   - @人员列表管理
   - 配置测试功能

2. **业务规则配置**
   - SLA时间阈值设置
   - 升级规则配置
   - 通知频率控制
   - 工作时间设置

### 历史分析界面
1. **趋势分析**
   - 逾期任务数量趋势
   - SLA达成率趋势
   - 各组织绩效变化
   - 季节性分析

2. **效果评估**
   - 通知前后对比
   - 系统上线前后对比
   - 不同策略效果对比
   - ROI 分析

## 🔧 技术要求

### 数据处理
- **实时性**: 数据更新延迟 < 5 分钟
- **准确性**: 100% 正确解析 Metabase 数据
- **容错性**: 网络异常时的重试机制
- **缓存**: 减少 API 调用频率

### 通知系统
- **可靠性**: 消息发送成功率 > 99%
- **及时性**: 逾期检测到通知发送 < 1 分钟
- **防骚扰**: 智能频率控制机制
- **可追踪**: 完整的通知发送记录

### Web 界面
- **响应性**: 页面加载时间 < 2 秒
- **实时性**: 数据自动刷新
- **易用性**: 直观的操作界面
- **移动端**: 响应式设计支持

## 📝 验收标准

### 功能验收
- [ ] 正确获取和解析 Metabase Card 1712 数据
- [ ] 准确计算各状态任务的逾期情况
- [ ] 按业务规则发送分级通知
- [ ] Web 界面展示真实数据和统计
- [ ] 配置管理功能正常工作

### 性能验收
- [ ] 数据处理延迟 < 5 分钟
- [ ] 通知发送延迟 < 1 分钟
- [ ] Web 界面响应时间 < 2 秒
- [ ] 系统 7x24 小时稳定运行

### 业务验收
- [ ] 销售人员能及时收到逾期提醒
- [ ] 运营人员能实时监控任务状态
- [ ] 逾期任务数量明显减少
- [ ] 用户满意度达到预期目标

---

**下一步**: 基于此需求规格开始技术实施，优先完成 Metabase 数据集成和业务逻辑实现。
